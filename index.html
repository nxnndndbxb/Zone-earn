<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Earning App - Premium UI</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-storage.js"></script>
    
    <style>
        /* --- Base Styles --- */
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; -webkit-tap-highlight-color: transparent; }
        
        body { 
            background-color: #031b38; 
            height: 100vh; 
            width: 100vw;
            overflow: hidden; 
        }

        .app-container { 
            width: 100%; 
            height: 100%; 
            background-color: #031b38; 
            position: relative; 
            display: flex; 
            flex-direction: column; 
        }

        /* --- AUTH SCREEN STYLES --- */
        .auth-screen { 
            position: absolute; 
            top: 0; left: 0; 
            width: 100%; height: 100%; 
            background: linear-gradient(135deg, #031b38 0%, #000000 100%); 
            z-index: 2000; 
            padding: 30px; 
            display: flex; 
            flex-direction: column; 
            justify-content: center; 
            align-items: center; 
            overflow-y: auto; 
            transition: transform 0.3s ease; 
        }
        
        .auth-content-box { width: 100%; max-width: 400px; }
        .auth-hidden { transform: translateY(100%); pointer-events: none; }
        .auth-logo { text-align: center; margin-bottom: 30px; }
        .auth-logo i { font-size: 60px; color: #e91e63; text-shadow: 0 0 15px rgba(233, 30, 99, 0.5); }
        .auth-title { color: white; font-size: 28px; font-weight: bold; text-align: center; margin-bottom: 10px; }
        .auth-subtitle { color: #aaa; text-align: center; margin-bottom: 30px; font-size: 14px; }
        .auth-form-group { margin-bottom: 15px; position: relative; width: 100%; }
        .auth-input { width: 100%; padding: 15px 15px 15px 45px; background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 12px; color: white; font-size: 14px; transition: border-color 0.3s; }
        .auth-input:focus { border-color: #e91e63; outline: none; background: rgba(255, 255, 255, 0.1); }
        .auth-icon { position: absolute; left: 15px; top: 50%; transform: translateY(-50%); color: #e91e63; }
        .country-group { display: flex; gap: 10px; }
        .country-select { width: 100px; background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 12px; color: white; padding: 0 10px; }
        .country-select option { background-color: #031b38; }
        .auth-btn { width: 100%; padding: 15px; background: linear-gradient(90deg, #e91e63, #ff4081); color: white; border: none; border-radius: 12px; font-size: 16px; font-weight: bold; cursor: pointer; margin-top: 10px; box-shadow: 0 5px 15px rgba(233, 30, 99, 0.3); transition: transform 0.2s; }
        .auth-btn:active { transform: scale(0.98); }
        .auth-link { text-align: center; margin-top: 20px; color: #aaa; font-size: 14px; }
        .auth-link span { color: #e91e63; cursor: pointer; font-weight: bold; }
        .forgot-password { text-align: right; margin-bottom: 20px; font-size: 12px; width: 100%; }
        .forgot-password span { color: #aaa; cursor: pointer; }

        /* --- Loading Overlay --- */
        #loadingOverlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 3000; display: flex; justify-content: center; align-items: center; flex-direction: column; color: white; display: none; }
        .spinner { border: 4px solid rgba(255,255,255,0.3); border-radius: 50%; border-top: 4px solid #e91e63; width: 40px; height: 40px; animation: spin 1s linear infinite; margin-bottom: 10px; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* --- Timer Circle Styles (reusable for timer page) --- */
        .timer-circle-container { position: relative; width: 150px; height: 150px; }
        .timer-svg { width: 150px; height: 150px; transform: rotate(-90deg); }
        .timer-circle-bg { fill: none; stroke: #333; stroke-width: 10; }
        .timer-circle-progress { 
            fill: none; stroke: #e91e63; stroke-width: 10; 
            stroke-dasharray: 440; stroke-dashoffset: 440; 
            transition: stroke-dashoffset 1s linear;
        }
        .timer-text { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 30px; font-weight: bold; }
        .ad-label { margin-top: 20px; font-size: 18px; color: #aaa; animation: pulse 1.5s infinite; }
        @keyframes pulse { 0% { opacity: 0.5; } 50% { opacity: 1; } 100% { opacity: 0.5; } }


        /* --- APP STYLES --- */
        header { background: linear-gradient(180deg, #c21558 0%, #750d37 100%); padding: 0 20px; display: flex; justify-content: space-between; align-items: center; height: 60px; flex-shrink: 0; z-index: 100; width: 100%; box-shadow: 0 2px 5px rgba(0,0,0,0.2); }
        .header-left { display: flex; align-items: center; gap: 10px; }
        .header-logo { background: white; padding: 5px; border-radius: 4px; font-size: 12px; color: #28a745; font-weight: bold; }
        .header-title { color: white; font-size: 16px; font-weight: bold; }
        .header-icon { color: white; font-size: 24px; }
        .back-btn { color: white; font-size: 18px; cursor: pointer; display: none; padding: 5px; }

        .page-wrapper { position: relative; flex-grow: 1; width: 100%; overflow: hidden; }
        .page-container { position: absolute; top: 0; left: 0; width: 100%; height: 100%; overflow-y: auto; overflow-x: hidden; padding-bottom: 80px; transition: transform 0.3s ease; background-color: #031b38; scrollbar-width: none; }
        .page-container::-webkit-scrollbar { display: none; }
        
        .page-content { padding: 20px; color: white; max-width: 1000px; margin: 0 auto; width: 100%; }

        .banner-container { padding: 20px; background: linear-gradient(180deg, #750d37 0%, #031b38 30%); display: flex; justify-content: center; }
        .banner { 
            background-color: transparent; 
            border-radius: 15px; 
            height: 180px; 
            width: 100%; 
            max-width: 800px; 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            overflow: hidden; 
            position: relative; 
            box-shadow: 0 5px 15px rgba(0,0,0,0.3); 
        }
        .banner img { width: 100%; height: 100%; object-fit: cover; border-radius: 15px; }
        
        .ticker-container { margin: 0 auto; max-width: 800px; background: linear-gradient(90deg, #c21558, #5a0a29); border-radius: 20px; padding: 10px 15px; display: flex; align-items: center; color: white; font-size: 14px; box-shadow: 0 4px 6px rgba(0,0,0,0.3); width: 90%; }
        .marquee { overflow: hidden; white-space: nowrap; width: 100%; margin-left: 10px; }
        .marquee span { display: inline-block; animation: scroll 10s linear infinite; }
        @keyframes scroll { 0% { transform: translateX(100%); } 100% { transform: translateX(-100%); } }

        .action-grid { 
            display: grid; grid-template-columns: repeat(auto-fit, minmax(80px, 1fr)); gap: 15px; 
            padding: 20px; background-color: #1a222c; margin: 20px auto; 
            border-radius: 15px; max-width: 800px;
        }
        .action-item { display: flex; flex-direction: column; align-items: center; cursor: pointer; transition: transform 0.2s; }
        .action-item:hover { transform: translateY(-5px); }
        .icon-box { width: 50px; height: 50px; border-radius: 12px; background: linear-gradient(135deg, #e91e63, #880e4f); display: flex; justify-content: center; align-items: center; color: white; font-size: 20px; margin-bottom: 8px; box-shadow: 0 4px 8px rgba(0,0,0,0.4); }
        .action-text { color: white; font-size: 12px; font-weight: 500; }

        .feature-grid { 
            display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; 
            padding: 0 20px; margin-bottom: 20px; max-width: 800px; margin-left: auto; margin-right: auto;
        }
        .feature-card { background-color: #1a222c; border-radius: 10px; padding: 20px; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 120px; cursor: pointer; transition: transform 0.2s; }
        .feature-card:active { transform: scale(0.95); }
        .feature-title { color: white; font-size: 14px; font-weight: bold; margin-bottom: 10px; }

        .page-title { font-size: 22px; margin-bottom: 20px; color: #e91e63; text-align: center; }
        .card { background-color: #1a222c; border-radius: 10px; padding: 20px; margin-bottom: 20px; box-shadow: 0 4px 6px rgba(0,0,0,0.2); }
        .card-title { font-size: 16px; margin-bottom: 15px; color: #ffca28; }
        
        .info-row { display: flex; justify-content: space-between; margin-bottom: 10px; padding-bottom: 10px; border-bottom: 1px solid #2c3542; }
        .info-label { color: #aaa; }
        .info-value { color: white; font-weight: bold; }

        .form-group { margin-bottom: 20px; }
        .form-label { display: block; margin-bottom: 8px; color: #aaa; }
        .form-input { width: 100%; padding: 12px; border-radius: 8px; border: 1px solid #2c3542; background-color: #0d1520; color: white; font-size: 14px; }
        
        /* Style for file input to match theme */
        .form-input[type="file"] { padding: 10px; }
        .form-input[type="file"]::-webkit-file-upload-button {
            background: #e91e63;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 6px;
            cursor: pointer;
            margin-right: 10px;
        }
        textarea.form-input { height: 100px; resize: none; }
        
        /* === NEW DEPOSIT PREVIEW STYLES === */
        .image-preview-container {
            width: 100%;
            margin-top: 15px;
            border: 2px dashed #2c3542;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            height: 150px;
            position: relative;
            background-color: #0d1520;
            overflow: hidden;
        }
        .image-preview {
            display: none;
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .image-preview-text {
            color: #aaa;
            font-size: 14px;
        }
        /* === END NEW STYLES === */

        .btn { width: 100%; padding: 15px; background: linear-gradient(135deg, #e91e63, #880e4f); color: white; border: none; border-radius: 10px; font-size: 16px; font-weight: bold; cursor: pointer; margin-top: 10px; transition: transform 0.2s; }
        .btn:hover { opacity: 0.9; }
        .btn:active { transform: scale(0.98); }
        .btn-secondary { background: linear-gradient(135deg, #2196f3, #0d47a1); }
        .btn-admin { background: linear-gradient(135deg, #d32f2f, #b71c1c); display: none; } 

        .payment-methods { display: flex; gap: 10px; margin-bottom: 20px; }
        .payment-method { flex: 1; text-align: center; padding: 15px; border: 2px solid #2c3542; border-radius: 10px; cursor: pointer; transition: all 0.3s; }
        .payment-method.active { border-color: #e91e63; background-color: rgba(233, 30, 99, 0.1); }
        .payment-icon { font-size: 30px; margin-bottom: 10px; color: #4caf50; }

        /* --- NEW PLAN STYLES (ADAPTED FOR DARK THEME & SMALLER SIZE) --- */
        .plans-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); /* smaller minmax */
            gap: 15px; /* reduced gap */
            margin-bottom: 30px;
        }
        
        .plan-card-new {
            background-color: #1a222c;
            border-radius: 12px;
            padding: 20px; /* reduced padding */
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
            transition: transform 0.3s, box-shadow 0.3s;
            text-align: center;
            position: relative;
            overflow: hidden;
            border-top: 5px solid #e91e63;
        }
        
        .plan-card-new:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 25px rgba(233, 30, 99, 0.2);
        }
        
        .investment-amount {
            font-size: 1.8rem; /* reduced font size */
            font-weight: 700;
            color: #e91e63;
            margin-bottom: 8px; /* reduced margin */
        }
        
        .unit {
            font-size: 1.1rem; /* reduced font size */
            font-weight: 600;
            color: #aaa;
        }
        
        .benefits-container {
            background-color: #0d1520;
            border-radius: 8px;
            padding: 12px; /* reduced padding */
            margin: 15px 0; /* reduced margin */
            text-align: right;
        }
        
        .benefit-item {
            display: flex;
            justify-content: space-between;
            padding: 6px 0; /* reduced padding */
            border-bottom: 1px dashed #2c3542;
            text-align: left;
            font-size: 14px; /* added font size */
        }
        
        .benefit-item:last-child { border-bottom: none; }
        .benefit-label { font-weight: 600; color: #aaa; }
        .benefit-value { font-weight: 700; color: white; }
        
        .duration {
            background-color: rgba(233, 30, 99, 0.1);
            color: #e91e63;
            padding: 6px 12px; /* reduced padding */
            border-radius: 20px;
            font-weight: 600;
            display: inline-block;
            margin-bottom: 15px; /* reduced margin */
            font-size: 12px; /* reduced font size */
        }
        
        .buy-btn-new {
            letter-spacing: 0.5px;
            padding: 12px; /* reduced padding */
            font-size: 14px; /* reduced font size */
        }
        
        .plan-number {
            position: absolute;
            top: 10px;
            left: 10px;
            background-color: #e91e63;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }
        /* --- END NEW PLAN STYLES --- */

        .task-item { background-color: #0d1520; border-radius: 10px; padding: 15px; margin-bottom: 10px; display: flex; align-items: center; justify-content: space-between; }
        .task-reward { color: #4caf50; font-weight: bold; }
        
        .invite-code-box { background: linear-gradient(135deg, #ff9800, #f57c00); padding: 20px; border-radius: 10px; text-align: center; margin-bottom: 20px; }
        .invite-code { font-size: 32px; font-weight: bold; letter-spacing: 5px; color: white; margin: 10px 0; word-break: break-all; }
        
        .stats-box { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-bottom: 20px; }
        .stat-card { background-color: #0d1520; padding: 15px; border-radius: 10px; text-align: center; }
        .stat-value { font-size: 20px; color: #4caf50; margin-bottom: 5px; }
        .stat-label { font-size: 10px; color: #aaa; }

        .history-table { width: 100%; border-collapse: collapse; }
        .history-table th { background-color: #0d1520; padding: 10px; text-align: left; color: #aaa; font-size: 12px; }
        .history-table td { padding: 12px; border-bottom: 1px solid #2c3542; color: #ddd; font-size: 13px; }
        .status { padding: 5px 10px; border-radius: 20px; font-size: 10px; font-weight: bold; text-transform: uppercase; }
        .status-pending { background-color: #ff9800; color: black; }
        .status-completed { background-color: #4caf50; color: white; }
        .status-rejected { background-color: #f44336; color: white; }

        .bottom-nav { 
            background-color: #1a222c; height: 70px; width: 100%; 
            display: flex; justify-content: center; align-items: center; 
            border-top: 1px solid #333; z-index: 500; 
            position: fixed; bottom: 0; left: 0; box-shadow: 0 -2px 10px rgba(0,0,0,0.3);
        }
        .nav-wrapper { display: flex; justify-content: space-around; width: 100%; max-width: 600px; position: relative; }
        .nav-item { display: flex; flex-direction: column; align-items: center; color: #888; font-size: 10px; cursor: pointer; width: 20%; padding-top: 10px; transition: color 0.3s; }
        .nav-item:hover { color: #ccc; }
        .nav-item i { font-size: 20px; margin-bottom: 4px; }
        .nav-item.active { color: #fff; }
        
        .center-btn-container { position: relative; top: -20px; }
        .center-btn { width: 60px; height: 60px; background: linear-gradient(135deg, #ff4081, #c51162); border-radius: 50%; display: flex; justify-content: center; align-items: center; border: 5px solid #1a222c; color: white; font-size: 28px; box-shadow: 0 -5px 10px rgba(0,0,0,0.3); cursor: pointer; transition: transform 0.2s; }
        .center-btn:hover { transform: scale(1.1); }

        .whatsapp-float { position: fixed; bottom: 85px; right: 20px; width: 55px; height: 55px; background-color: #25D366; border-radius: 50%; display: flex; justify-content: center; align-items: center; color: white; font-size: 30px; box-shadow: 0 4px 10px rgba(0,0,0,0.5); border: 2px solid white; z-index: 999; cursor: pointer; transition: transform 0.1s; }
        .whatsapp-float:active { transform: scale(0.95); }

        .profile-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 20px; }
        .profile-left { display: flex; align-items: center; gap: 10px; }
        .profile-right { text-align: right; }
        .avatar-circle { width: 70px; height: 70px; border-radius: 50%; background: #1a222c; border: 2px solid #e91e63; overflow: hidden; flex-shrink: 0; }
        .avatar-circle img { width: 100%; height: 100%; object-fit: cover; display: block; }
        .user-name { font-size: 16px; font-weight: 600; color: white; }
        .balance-label { font-size: 10px; color: #ccc; margin-top: 5px; }
        .balance-amount { color: #fdd835; font-size: 18px; font-weight: bold; }
        
        .stats-row { border-top: 1px solid #333; padding-top: 15px; display: flex; justify-content: space-around; align-items: center; margin-top: 10px; }
        .stat-item { text-align: center; width: 45%; }
        .vertical-divider { width: 1px; height: 30px; background-color: #333; }

        .action-row { display: flex; justify-content: space-around; margin: 20px 0; padding: 0; }
        .action-btn { display: flex; flex-direction: column; align-items: center; cursor: pointer; transition: opacity 0.2s; }
        .action-btn:hover { opacity: 0.8; }
        .btn-icon { width: 45px; height: 45px; background-color: #1a222c; border-radius: 50%; display: flex; justify-content: center; align-items: center; margin-bottom: 5px; color: #e91e63; font-size: 18px; box-shadow: 0 2px 5px rgba(0,0,0,0.3); }
        .btn-text { font-size: 12px; color: #ccc; }

        .menu-group { background-color: #1a222c; border-radius: 12px; margin-bottom: 15px; overflow: hidden; }
        .menu-item { display: flex; justify-content: space-between; align-items: center; padding: 15px; border-bottom: 1px solid #2c3542; cursor: pointer; transition: background 0.2s; }
        .menu-item:hover { background-color: #242d38; }
        .menu-left { display: flex; align-items: center; gap: 10px; }
        .menu-icon-circle { width: 30px; height: 30px; border-radius: 50%; display: flex; justify-content: center; align-items: center; background-color: rgba(233, 30, 99, 0.1); color: #e91e63; }
        .menu-text { color: white; font-size: 14px; }
        .menu-item:last-child { border-bottom: none; }

        .page-active { transform: translateX(0); }
        .page-inactive { transform: translateX(100%); }
        
        .alert { position: fixed; top: 20px; left: 50%; transform: translateX(-50%); background-color: #4caf50; color: white; padding: 15px 30px; border-radius: 10px; z-index: 5000; display: none; box-shadow: 0 5px 15px rgba(0,0,0,0.3); white-space: nowrap; }
        @keyframes slideDown { from { top: -100px; } to { top: 20px; } }

        /* --- NEW REDESIGNED TASK DASHBOARD --- */
        .task-dashboard-v2 {
            background-color: #1a222c;
            border-radius: 20px;
            padding: 15px;
            margin-bottom: 25px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
        }
        
        .task-stats-series {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 15px;
        }

        .task-stat-card-v2 {
            background: #000; /* Black background */
            border-radius: 15px;
            padding: 20px;
            display: flex;
            flex-direction: row; /* Horizontal layout */
            align-items: center; /* Vertically center items */
            justify-content: space-between; /* Puts label on left, count on right */
            position: relative;
            overflow: hidden;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
            transition: transform 0.2s;
            min-height: 70px; /* Decreased height */
        }
        .task-stat-card-v2:active { transform: scale(0.98); }
        
        .stat-v2-label { 
            font-size: 14px; /* Larger label */
            color: rgba(255,255,255,0.8); 
            text-transform: uppercase; 
            letter-spacing: 0.5px; 
            font-weight: 600;
        }
        .stat-v2-count { 
            font-size: 26px; /* Larger count */
            font-weight: 800; 
            color: white; 
            margin-top: 0; /* Removed top margin */
        }

        .card-completed {
            border: 1px solid rgba(100, 181, 246, 0.3);
        }
        .card-remaining {
            border: 1px solid rgba(225, 190, 231, 0.3);
        }

        .stat-icon-circle {
            width: 35px; height: 35px;
            border-radius: 50%;
            background: rgba(255,255,255,0.2);
            display: flex; justify-content: center; align-items: center;
            margin-bottom: 8px;
            color: white; font-size: 16px;
        }

        .task-timer-section {
            background: rgba(13, 21, 32, 0.6);
            border-radius: 12px;
            padding: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border: 1px solid #2c3542;
        }
        .timer-label-box { display: flex; align-items: center; gap: 8px; }
        .timer-icon { color: #fdd835; animation: pulse-icon 2s infinite; }
        .timer-text-label { font-size: 12px; color: #ccc; }
        .timer-digital { font-family: 'Courier New', monospace; font-size: 18px; color: #4caf50; font-weight: bold; letter-spacing: 1px; }

        @keyframes pulse-icon { 0% { opacity: 0.7; } 50% { opacity: 1; transform: scale(1.1); } 100% { opacity: 0.7; } }


        /* --- CUSTOM MODAL STYLES --- */
        .custom-modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8); z-index: 6000;
            display: flex; justify-content: center; align-items: center;
            opacity: 0; pointer-events: none; transition: opacity 0.3s;
        }
        .custom-modal.open { opacity: 1; pointer-events: auto; }
        .modal-content {
            background: #1a222c; width: 90%; max-width: 400px;
            border-radius: 15px; padding: 25px;
            position: relative; transform: translateY(20px); transition: transform 0.3s;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }
        .custom-modal.open .modal-content { transform: translateY(0); }
        .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; border-bottom: 1px solid #333; padding-bottom: 10px; }
        .modal-title { font-size: 18px; font-weight: bold; color: white; }
        .modal-close { color: #aaa; font-size: 24px; cursor: pointer; }
        
        .commission-card { background: linear-gradient(135deg, #1e3c72, #2a5298); padding: 20px; border-radius: 12px; text-align: center; margin-bottom: 15px; }

        /* Account Modal Specifics */
        .modal-avatar-container { display: flex; justify-content: center; margin-bottom: 20px; }
        .modal-avatar { width: 100px; height: 100px; border-radius: 50%; border: 3px solid #e91e63; object-fit: cover; box-shadow: 0 0 15px rgba(233, 30, 99, 0.4); }
        .modal-edit-hint { text-align: center; color: #aaa; font-size: 12px; margin-bottom: 20px; }

    </style>
</head>
<body>

<!-- Loading Overlay -->
<div id="loadingOverlay">
    <div class="spinner"></div>
    <div id="loadingText">Loading...</div>
</div>

<!-- Alert Message -->
<div class="alert" id="alert">Operation Successful!</div>

<div class="app-container">

<!-- ================= AUTHENTICATION SECTION ================= -->

<!-- Login Screen -->
<div class="auth-screen" id="loginScreen">
    <div class="auth-content-box">
        <div class="auth-logo"><i class="fa-solid fa-gem"></i></div>
        <div class="auth-title">Welcome Back</div>
        <div class="auth-subtitle">Login to your account to continue earning</div>
        <div class="auth-form-group"><i class="fa-solid fa-envelope auth-icon"></i><input type="email" id="loginEmail" class="auth-input" placeholder="Enter your email"></div>
        <div class="auth-form-group"><i class="fa-solid fa-lock auth-icon"></i><input type="password" id="loginPassword" class="auth-input" placeholder="Password"></div>
        <div class="forgot-password"><span onclick="showForgotPassword()">Forgot Password?</span></div>
        <button class="auth-btn" onclick="handleLogin()">LOGIN</button>
        <div class="auth-link">Don't have an account? <span onclick="showRegister()">Register Now</span></div>
    </div>
</div>

<!-- Register Screen -->
<div class="auth-screen auth-hidden" id="registerScreen">
    <div class="auth-content-box">
        <div class="auth-logo" style="margin-bottom: 20px;"><i class="fa-solid fa-user-plus"></i></div>
        <div class="auth-title">Create Account</div>
        <div class="auth-subtitle">Join us and start earning today</div>
        <div class="auth-form-group"><i class="fa-solid fa-envelope auth-icon"></i><input type="email" id="regEmail" class="auth-input" placeholder="Gmail Address"></div>
        <div class="auth-form-group country-group">
            <select id="countryCode" class="country-select"><option value="+92">+92 (PK)</option><option value="+91">+91 (IN)</option></select>
            <input type="number" id="regPhone" class="auth-input" style="padding-left: 15px;" placeholder="Phone Number">
        </div>
        <div class="auth-form-group"><i class="fa-solid fa-lock auth-icon"></i><input type="password" id="regPassword" class="auth-input" placeholder="Strong Password"></div>
        <div class="auth-form-group"><i class="fa-solid fa-lock auth-icon"></i><input type="password" id="regConfirmPassword" class="auth-input" placeholder="Repeat Password"></div>
        <div class="auth-form-group"><i class="fa-solid fa-ticket auth-icon"></i><input type="text" id="regInviteCode" class="auth-input" placeholder="Invitation Code"></div>
        <button class="auth-btn" onclick="handleRegister()">REGISTER</button>
        <div class="auth-link">Already have an account? <span onclick="showLogin()">Login Here</span></div>
    </div>
</div>

<!-- Forgot Password Screen -->
<div class="auth-screen auth-hidden" id="forgotScreen">
    <div class="auth-content-box">
        <div class="auth-logo"><i class="fa-solid fa-key"></i></div>
        <div class="auth-title">Reset Password</div>
        <div class="auth-subtitle">Enter your email to receive reset link</div>
        <div class="auth-form-group"><i class="fa-solid fa-envelope auth-icon"></i><input type="email" id="resetEmail" class="auth-input" placeholder="Enter your registered email"></div>
        <button class="auth-btn" onclick="handleResetPassword()">SEND LINK</button>
        <button class="auth-btn btn-secondary" onclick="showLogin()">BACK TO LOGIN</button>
    </div>
</div>

<!-- ================= MAIN APP CONTENT (Hidden until login) ================= -->

<div id="mainAppContent" style="display: none; height: 100%; flex-direction: column;">

<!-- Header -->
<header>
    <div class="header-left">
        <div class="back-btn" id="backBtn" onclick="goBack()"><i class="fas fa-arrow-left"></i></div>
        <div class="header-logo"><i class="fa-solid fa-money-bill-wave"></i></div>
        <div class="header-title" id="pageTitle">Earning App</div>
    </div>
    <div class="header-icon">
        <i class="fa-solid fa-power-off" onclick="logout()" style="font-size: 18px; cursor: pointer;"></i>
    </div>
</header>

<!-- Page Wrapper -->
<div class="page-wrapper">
    
    <!-- Home Page -->
    <div class="page-container page-active" id="homePage">
        <div class="banner-container">
            <div class="banner">
                <img src="https://iili.io/fazQxyB.jpg" alt="Banner">
            </div>
        </div>
        <div class="ticker-container">
            <i class="fa-solid fa-volume-high ticker-icon"></i>
            <div class="marquee"><span>Don't create multiple accounts! Join now for rewards. Withdrawals approved within 1 hour.</span></div>
        </div>
        <div class="action-grid">
            <div class="action-item" onclick="showPage('depositPage')"><div class="icon-box"><i class="fa-solid fa-arrow-up"></i></div><span class="action-text">Deposit</span></div>
            <div class="action-item" onclick="showPage('withdrawPage')"><div class="icon-box"><i class="fa-solid fa-arrow-down"></i></div><span class="action-text">Withdraw</span></div>
            <div class="action-item" onclick="showPage('invitePage')"><div class="icon-box"><i class="fa-solid fa-user-plus"></i></div><span class="action-text">Invite</span></div>
            <div class="action-item" onclick="showPage('supportPage')"><div class="icon-box"><i class="fa-solid fa-headset"></i></div><span class="action-text">Support</span></div>
        </div>
        <div class="feature-grid">
            <div class="feature-card" onclick="showPage('plansPage')"><span class="feature-title">VIP Plans</span><div style="position: relative;"><i class="fa-solid fa-shield-halved" style="color: #7c4dff; font-size: 40px;"></i><i class="fa-solid fa-coins" style="color: #ffca28; position: absolute; bottom: -5px; right: -10px; font-size: 20px;"></i></div></div>
            <div class="feature-card" onclick="showPage('tasksPage')"><span class="feature-title">Tasks</span><i class="fa-solid fa-envelope-open-text" style="color: #7c4dff; font-size: 40px;"></i></div>
        </div>
    </div>

    <!-- Support Page -->
    <div class="page-container page-inactive" id="supportPage">
        <div class="page-content">
            <h2 class="page-title">Contact Admin</h2>
            <div class="card">
                <h3 class="card-title">Send a Message</h3>
                <div class="form-group"><label class="form-label">Subject</label><input type="text" class="form-input" id="supportSubject" placeholder="Brief topic of your issue"></div>
                <div class="form-group"><label class="form-label">Message</label><textarea class="form-input" id="supportMessage" placeholder="Describe your issue or question in detail..."></textarea></div>
                <button class="btn" onclick="sendEmailToAdmin()">Send Message via Email</button>
            </div>
        </div>
    </div>

    <!-- Deposit Page -->
    <div class="page-container page-inactive" id="depositPage">
        <div class="page-content">
            <h2 class="page-title">Deposit Funds</h2>
            <div class="card">
                <h3 class="card-title">Payment Details</h3>
                <div class="info-row"><span class="info-label">Bank Name:</span><span class="info-value" id="depBankName">Loading...</span></div>
                <div class="info-row"><span class="info-label">Account Number:</span><span class="info-value" id="depAccNum">Loading...</span></div>
                <div class="info-row"><span class="info-label">Account Holder:</span><span class="info-value" id="depAccTitle">Loading...</span></div>
            </div>
            <div class="card">
                <h3 class="card-title">Submit Proof</h3>
                <!-- === EDITED DEPOSIT SYSTEM HTML START === -->
                <div class="form-group">
                    <label class="form-label">Payment Proof (Screenshot)</label>
                    <input type="file" class="form-input" id="depositProofImage" accept="image/*" onchange="previewDepositImage(event)">
                    <div class="image-preview-container" id="depositPreviewContainer">
                        <img src="" alt="Image Preview" class="image-preview" id="depositImagePreview">
                        <span class="image-preview-text" id="depositPreviewText">Image Preview</span>
                    </div>
                </div>
                 <!-- === EDITED DEPOSIT SYSTEM HTML END === -->
                <div class="form-group">
                    <label class="form-label">Amount (Rs)</label>
                    <input type="number" class="form-input" id="depositAmount" placeholder="Enter amount sent">
                </div>
                <button class="btn" onclick="submitDeposit()">Submit Deposit</button>
            </div>
        </div>
    </div>


    <!-- Deposit History Page -->
    <div class="page-container page-inactive" id="depositHistoryPage">
        <div class="page-content">
            <h2 class="page-title">Deposit History</h2>
            <div class="card">
                <table class="history-table">
                    <thead><tr><th>Date</th><th>Amount</th><th>Status</th></tr></thead>
                    <tbody id="depositHistory"></tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Withdraw Page -->
    <div class="page-container page-inactive" id="withdrawPage">
        <div class="page-content">
            <h2 class="page-title">Withdraw Funds</h2>
            <div class="card">
                <h3 class="card-title">Method</h3>
                <div class="payment-methods">
                    <div class="payment-method" onclick="selectWithdrawMethod('easypaisa')"><i class="fa-solid fa-mobile-alt payment-icon"></i><div>Easypaisa</div></div>
                    <div class="payment-method active" onclick="selectWithdrawMethod('jazcash')"><i class="fa-solid fa-building payment-icon"></i><div>JazzCash</div></div>
                </div>
            </div>
            <div class="card">
                <h3 class="card-title">Details</h3>
                <div class="form-group"><label class="form-label">Account Number</label><input type="text" class="form-input" id="withdrawAccount"></div>
                <div class="form-group"><label class="form-label">Account Title</label><input type="text" class="form-input" id="withdrawName"></div>
                <div class="form-group"><label class="form-label">Amount</label><input type="number" class="form-input" id="withdrawAmount"></div>
                <button class="btn" onclick="submitWithdraw()">Submit Withdrawal</button>
            </div>
        </div>
    </div>

     <!-- Withdraw History Page -->
     <div class="page-container page-inactive" id="withdrawHistoryPage">
        <div class="page-content">
            <h2 class="page-title">Withdrawal History</h2>
            <div class="card">
                <table class="history-table">
                    <thead><tr><th>Date</th><th>Amount</th><th>Status</th></tr></thead>
                    <tbody id="withdrawHistory"></tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Invite Page -->
    <div class="page-container page-inactive" id="invitePage">
        <div class="page-content">
            <h2 class="page-title">Invite & Earn</h2>
            <div class="invite-code-box">
                <div>Your Code</div>
                <div class="invite-code" id="myInviteCode">LOADING</div>
                <button class="btn btn-secondary" onclick="copyInviteCode()"><i class="fas fa-copy"></i> Copy</button>
            </div>
            <div class="stats-box">
                <div class="stat-card"><div class="stat-value" id="totalInvites">0</div><div class="stat-label">Total Invites</div></div>
                <div class="stat-card"><div class="stat-value" id="activeInvites">0</div><div class="stat-label">Active Invites</div></div>
                <div class="stat-card"><div class="stat-value" id="inviteEarnings">Rs 0</div><div class="stat-label">Total Earnings</div></div>
            </div>
            <div class="card">
                <h3 class="card-title">Link</h3>
                <div class="form-group"><input type="text" class="form-input" id="inviteLink" readonly></div>
                <button class="btn btn-secondary" onclick="shareInviteLink()"><i class="fas fa-share-alt"></i> Share Link</button>
            </div>
        </div>
    </div>

    <!-- Admin Panel (Hidden) -->
    <div class="page-container page-inactive" id="adminPanelPage">
        <div class="page-content">
            <h2 class="page-title">ADMIN PANEL</h2>
            <div class="card">
                <h3 class="card-title">Update Bank Details</h3>
                <div class="form-group"><label class="form-label">Bank Name / Method</label><input type="text" class="form-input" id="adminBankName"></div>
                <div class="form-group"><label class="form-label">Account Number</label><input type="text" class="form-input" id="adminAccNum"></div>
                <div class="form-group"><label class="form-label">Account Title</label><input type="text" class="form-input" id="adminAccTitle"></div>
                <button class="btn" onclick="saveBankDetails()">Update Bank Details</button>
            </div>
        </div>
    </div>

    <!-- Tasks Page -->
    <div class="page-container page-inactive" id="tasksPage">
        <div class="page-content">
            <h2 class="page-title">Daily Tasks</h2>
            <div class="card" id="noPlanWarning" style="display: none;">
                <h3 class="card-title" style="color: #f44336;"><i class="fas fa-exclamation-triangle"></i> No Active Plan</h3>
                <p style="color: #aaa;">Activate a plan to start earning.</p>
                <button class="btn" onclick="showPage('plansPage')">View Plans</button>
            </div>
            <div class="card" id="taskLimitWarning" style="display: none;">
                <h3 class="card-title" style="color: #4caf50;"><i class="fas fa-check-circle"></i> Tasks Completed</h3>
                <p style="color: #aaa;">You have completed your daily tasks. Come back tomorrow for more!</p>
            </div>
            <div id="tasksList"></div>
        </div>
    </div>

    <!-- Ad Timer Page -->
    <div class="page-container page-inactive" id="adTimerPage">
        <div class="page-content" style="display: flex; flex-direction: column; justify-content: center; align-items: center; height: 100%;">
            <h2 class="page-title">Watching Ad</h2>
            <p style="color: #aaa; text-align: center; margin-bottom: 30px;">Your ad is playing in a new tab. Please wait for the timer to finish to receive your reward.</p>
            <div class="timer-circle-container" style="margin-bottom: 20px;">
                 <svg class="timer-svg">
                    <circle class="timer-circle-bg" cx="75" cy="75" r="70"></circle>
                    <circle class="timer-circle-progress" cx="75" cy="75" r="70" id="adPageTimerProgress"></circle>
                </svg>
                <div class="timer-text" id="adPageTimerCount">10</div>
            </div>
             <p style="color: #aaa; text-align: center;">Do not close this page.</p>
        </div>
    </div>

    <!-- Plans Page -->
    <div class="page-container page-inactive" id="plansPage">
        <div class="page-content">
            <h2 class="page-title">Zone Earn Plans</h2>
            
            <div class="plans-container">
                <!-- Plan 0: 300 PKR -->
                <div class="plan-card-new">
                    <div class="plan-number">0</div>
                    <div class="investment-amount">300 <span class="unit">PKR</span></div>
                    <div class="benefits-container">
                        <div class="benefit-item">
                            <span class="benefit-label">Daily Profit</span>
                            <span class="benefit-value">75</span>
                        </div>
                        <div class="benefit-item">
                            <span class="benefit-label">Daily Ads</span>
                            <span class="benefit-value">3</span>
                        </div>
                    </div>
                    <div class="duration">Duration 65 Days</div>
                    <button class="btn buy-btn-new" onclick="buyPlan(300)">BUY NOW</button>
                </div>

                <!-- Plan 1: 750 PKR -->
                <div class="plan-card-new">
                    <div class="plan-number">1</div>
                    <div class="investment-amount">750 <span class="unit">PKR</span></div>
                    <div class="benefits-container">
                        <div class="benefit-item">
                            <span class="benefit-label">Daily Profit</span>
                            <span class="benefit-value">300</span>
                        </div>
                        <div class="benefit-item">
                            <span class="benefit-label">Daily Ads</span>
                            <span class="benefit-value">6</span>
                        </div>
                    </div>
                    <div class="duration">Duration 65 Days</div>
                    <button class="btn buy-btn-new" onclick="buyPlan(750)">BUY NOW</button>
                </div>
                
                <!-- Plan 2: 1000 PKR -->
                <div class="plan-card-new">
                    <div class="plan-number">2</div>
                    <div class="investment-amount">1000 <span class="unit">PKR</span></div>
                    <div class="benefits-container">
                        <div class="benefit-item">
                            <span class="benefit-label">Daily Profit</span>
                            <span class="benefit-value">400</span>
                        </div>
                        <div class="benefit-item">
                            <span class="benefit-label">Daily Ads</span>
                            <span class="benefit-value">8</span>
                        </div>
                    </div>
                    <div class="duration">Duration 65 Days</div>
                    <button class="btn buy-btn-new" onclick="buyPlan(1000)">BUY NOW</button>
                </div>
                
                <!-- Plan 3: 1500 PKR -->
                <div class="plan-card-new">
                    <div class="plan-number">3</div>
                    <div class="investment-amount">1500 <span class="unit">PKR</span></div>
                    <div class="benefits-container">
                        <div class="benefit-item">
                            <span class="benefit-label">Daily Profit</span>
                            <span class="benefit-value">500</span>
                        </div>
                        <div class="benefit-item">
                            <span class="benefit-label">Daily Ads</span>
                            <span class="benefit-value">10</span>
                        </div>
                    </div>
                    <div class="duration">Duration 65 Days</div>
                    <button class="btn buy-btn-new" onclick="buyPlan(1500)">BUY NOW</button>
                </div>
                
                <!-- Plan 4: 3000 PKR -->
                <div class="plan-card-new">
                    <div class="plan-number">4</div>
                    <div class="investment-amount">3000 <span class="unit">PKR</span></div>
                    <div class="benefits-container">
                        <div class="benefit-item">
                            <span class="benefit-label">Daily Profit</span>
                            <span class="benefit-value">750</span>
                        </div>
                        <div class="benefit-item">
                            <span class="benefit-label">Daily Ads</span>
                            <span class="benefit-value">15</span>
                        </div>
                    </div>
                    <div class="duration">Duration 65 Days</div>
                    <button class="btn buy-btn-new" onclick="buyPlan(3000)">BUY NOW</button>
                </div>
                
                <!-- Plan 5: 5000 PKR -->
                <div class="plan-card-new">
                    <div class="plan-number">5</div>
                    <div class="investment-amount">5000 <span class="unit">PKR</span></div>
                    <div class="benefits-container">
                        <div class="benefit-item">
                            <span class="benefit-label">Daily Profit</span>
                            <span class="benefit-value">1000</span>
                        </div>
                        <div class="benefit-item">
                            <span class="benefit-label">Daily Ads</span>
                            <span class="benefit-value">20</span>
                        </div>
                    </div>
                    <div class="duration">Duration 65 Days</div>
                    <button class="btn buy-btn-new" onclick="buyPlan(5000)">BUY NOW</button>
                </div>
            </div>
        </div>
    </div>

    <!-- App Page -->
    <div class="page-container page-inactive" id="appPage">
        <div class="page-content">
            <div style="text-align: center; padding: 50px 20px;">
                <i class="fa-brands fa-google-play" style="font-size: 80px; color: #4caf50; margin-bottom: 20px;"></i>
                <h2 class="page-title">Coming Soon</h2>
                <p style="color: #aaa; margin-bottom: 30px;">Our mobile app is under development.</p>
                <button class="btn" onclick="showPage('homePage')">Back to Home</button>
            </div>
        </div>
    </div>

    <!-- Profile Page -->
    <div class="page-container page-inactive" id="profilePage">
        <div class="page-content">
            <div class="card profile-card">
                <div class="profile-header">
                    <div class="profile-left">
                        <div class="avatar-circle">
                            <img id="userProfilePic" src="https://iili.io/f75iDuI.jpg" alt="Profile">
                        </div>
                        <div style="margin-left: 10px;">
                            <div class="user-name" id="displayEmail">User</div>
                            <div style="font-size: 10px; color: #4caf50;">Verified User</div>
                        </div>
                    </div>
                    <div class="profile-right">
                        <div class="balance-label">Balance</div>
                        <div class="balance-amount">Rs <span id="walletBalance">0.00</span></div>
                    </div>
                </div>
                <div class="stats-row">
                    <div class="stat-item"><div class="stat-value" id="totalDeposit">Rs 0</div><div class="stat-label">Deposit</div></div>
                    <div class="vertical-divider"></div>
                    <div class="stat-item"><div class="stat-value" id="totalWithdraw">Rs 0</div><div class="stat-label">Withdraw</div></div>
                </div>
            </div>

            <!-- BUTTONS -->
            <div class="action-row">
                <div class="action-btn" onclick="showPage('depositPage')"><div class="btn-icon"><i class="fa-solid fa-arrow-up"></i></div><span class="btn-text">Deposit</span></div>
                <div class="action-btn" onclick="showPage('invitePage')"><div class="btn-icon"><i class="fa-solid fa-user-plus"></i></div><span class="btn-text">Invite</span></div>
                <div class="action-btn" onclick="showPage('withdrawPage')"><div class="btn-icon"><i class="fa-solid fa-arrow-down"></i></div><span class="btn-text">Withdraw</span></div>
            </div>

            <!-- REDESIGNED TASK DASHBOARD -->
            <div class="task-dashboard-v2">
                <!-- Row 1: Series of Task Stats -->
                <div class="task-stats-series">
                    <!-- Completed -->
                    <div class="task-stat-card-v2 card-completed">
                        <span class="stat-v2-label">Completed</span>
                        <span class="stat-v2-count" id="taskCompletedCount">0</span>
                    </div>
                    <!-- Available -->
                    <div class="task-stat-card-v2 card-remaining">
                        <span class="stat-v2-label">Available</span>
                        <span class="stat-v2-count" id="taskRemainCount">0</span>
                    </div>
                </div>
                
                <!-- Row 2: Timer at Bottom -->
                <div class="task-timer-section">
                    <div class="timer-label-box">
                        <i class="fa-solid fa-clock timer-icon"></i>
                        <span class="timer-text-label">NEXT RESET IN:</span>
                    </div>
                    <div class="timer-digital" id="nextReminderTimer">00:00:00</div>
                </div>
            </div>

            <!-- Settings -->
            <h3 style="color: #aaa; font-size: 14px; margin: 15px 0 10px 5px; text-transform: uppercase;">Account Settings</h3>
            <div class="menu-group">
                <div class="menu-item" onclick="openModal('accountInfoModal')">
                    <div class="menu-left"><div class="menu-icon-circle" style="background: rgba(33, 150, 243, 0.1); color: #2196f3;"><i class="fa-solid fa-id-card"></i></div><span class="menu-text">Account Information</span></div>
                    <i class="fa-solid fa-chevron-right" style="color: #555;"></i>
                </div>
                <div class="menu-item" onclick="openModal('changePassModal')">
                    <div class="menu-left"><div class="menu-icon-circle" style="background: rgba(244, 67, 54, 0.1); color: #f44336;"><i class="fa-solid fa-lock"></i></div><span class="menu-text">Change Password</span></div>
                    <i class="fa-solid fa-chevron-right" style="color: #555;"></i>
                </div>
            </div>

            <h3 style="color: #aaa; font-size: 14px; margin: 15px 0 10px 5px; text-transform: uppercase;">History & Records</h3>
            <div class="menu-group">
                <div class="menu-item" onclick="openModal('commissionModal')">
                    <div class="menu-left"><div class="menu-icon-circle" style="background: rgba(255, 152, 0, 0.1); color: #ff9800;"><i class="fa-solid fa-users-viewfinder"></i></div><span class="menu-text">Invitation Commission</span></div>
                    <i class="fa-solid fa-chevron-right" style="color: #555;"></i>
                </div>
                <div class="menu-item" onclick="showPage('depositHistoryPage')"><div class="menu-left"><div class="menu-icon-circle"><i class="fa-regular fa-credit-card"></i></div><span class="menu-text">Deposit History</span></div><i class="fa-solid fa-chevron-right" style="color: #555;"></i></div>
                <div class="menu-item" onclick="showPage('withdrawHistoryPage')"><div class="menu-left"><div class="menu-icon-circle"><i class="fa-solid fa-money-bill-transfer"></i></div><span class="menu-text">Withdraw History</span></div><i class="fa-solid fa-chevron-right" style="color: #555;"></i></div>
            </div>
            
            <div class="menu-group">
                <div class="menu-item" onclick="logout()"><div class="menu-left"><div class="menu-icon-circle"><i class="fa-solid fa-right-from-bracket"></i></div><span class="menu-text">Logout</span></div><i class="fa-solid fa-chevron-right" style="color: #555;"></i></div>
            </div>
            <button id="adminAccessBtn" class="btn btn-admin" onclick="showPage('adminPanelPage')">ADMIN PANEL</button>
        </div>
    </div>

</div>

<!-- Bottom Nav -->
<nav class="bottom-nav">
    <div class="nav-wrapper">
        <div class="nav-item active" onclick="showPage('homePage')"><i class="fa-solid fa-house-chimney" style="color: #ff8a65;"></i><span>Home</span></div>
        <div class="nav-item" onclick="showPage('tasksPage')"><i class="fa-solid fa-clipboard-list" style="color: #4fc3f7;"></i><span>Task</span></div>
        <div class="nav-item center-btn-container"><div class="center-btn" onclick="showPage('plansPage')"><i class="fa-brands fa-firefox"></i></div></div>
        <div class="nav-item" onclick="showPage('appPage')"><i class="fa-brands fa-google-play" style="color: #ffd54f;"></i><span>APP</span></div>
        <div class="nav-item" onclick="showPage('profilePage')"><i class="fa-solid fa-circle-user" style="color: #ba68c8;"></i><span>Profile</span></div>
    </div>
</nav>
</div>

<!-- Float Whatsapp -->
<div class="whatsapp-float" id="whatsappFloat" onclick="handleClickWhatsapp()"><i class="fa-brands fa-whatsapp"></i></div>

<!-- ================= NEW MODALS FOR PROFILE BUTTONS ================= -->

<!-- Account Info Modal -->
<div id="accountInfoModal" class="custom-modal">
    <div class="modal-content">
        <div class="modal-header">
            <span class="modal-title">Edit Profile</span>
            <span class="modal-close" onclick="closeModal('accountInfoModal')">&times;</span>
        </div>
        
        <div class="modal-avatar-container">
            <img src="https://iili.io/f75iDuI.jpg" id="modalUserImg" class="modal-avatar" alt="User Pic">
        </div>
        <div class="modal-edit-hint">Update your contact details</div>

        <div class="form-group">
            <label class="form-label">Email (Username)</label>
            <input type="text" class="form-input" id="editEmail" readonly style="opacity: 0.6;">
        </div>
        
        <div class="form-group">
            <label class="form-label">Phone Number</label>
            <input type="text" class="form-input" id="editPhone" placeholder="Update Phone">
        </div>

        <div class="form-group">
            <label class="form-label">Joined Date</label>
            <input type="text" class="form-input" id="editJoinDate" readonly style="opacity: 0.6;">
        </div>
        
        <button class="btn" onclick="saveAccountInfo()">Save Changes</button>
    </div>
</div>

<!-- Commission Modal -->
<div id="commissionModal" class="custom-modal">
    <div class="modal-content">
        <div class="modal-header">
            <span class="modal-title">Commission Details</span>
            <span class="modal-close" onclick="closeModal('commissionModal')">&times;</span>
        </div>
        <div class="commission-card">
            <div style="font-size: 12px; color: #ccc; margin-bottom: 5px;">TOTAL EARNINGS</div>
            <div style="font-size: 28px; font-weight: bold; color: #fdd835;" id="commTotalEarned">Rs 0.00</div>
        </div>
        <div class="stats-box" style="margin-bottom: 0;">
            <div class="stat-card" style="background: #151d27;">
                <div class="stat-value" id="commTotalInvites">0</div>
                <div class="stat-label">Total Team</div>
            </div>
            <div class="stat-card" style="background: #151d27;">
                <div class="stat-value" id="commActiveInvites">0</div>
                <div class="stat-label">Active VIPs</div>
            </div>
        </div>
        <button class="btn" style="margin-top: 20px;" onclick="closeModal('commissionModal'); showPage('invitePage')">Invite More</button>
    </div>
</div>

<!-- Change Password Modal -->
<div id="changePassModal" class="custom-modal">
    <div class="modal-content">
        <div class="modal-header">
            <span class="modal-title">Change Password</span>
            <span class="modal-close" onclick="closeModal('changePassModal')">&times;</span>
        </div>
        <div class="form-group">
            <label class="form-label">New Password</label>
            <input type="password" class="form-input" id="newPasswordInput" placeholder="Enter new strong password">
        </div>
        <div class="form-group">
            <label class="form-label">Confirm Password</label>
            <input type="password" class="form-input" id="confirmNewPasswordInput" placeholder="Repeat new password">
        </div>
        <button class="btn" onclick="doChangePassword()">Update Password</button>
    </div>
</div>


<script>
    // --- ADMIN CONFIGURATION ---
    const ADMIN_EMAIL = "mrk443901@gmail.com"; 

    // --- NEW PLAN CONFIGURATION ---
    const PLAN_CONFIG = {
        300:   { dailyLimit: 3,  earningPerTask: 25, dailyProfit: 75 },
        750:   { dailyLimit: 6,  earningPerTask: 50, dailyProfit: 300 },
        1000:  { dailyLimit: 8,  earningPerTask: 50, dailyProfit: 400 },
        1500:  { dailyLimit: 10, earningPerTask: 50, dailyProfit: 500 },
        3000:  { dailyLimit: 15, earningPerTask: 50, dailyProfit: 750 },
        5000:  { dailyLimit: 20, earningPerTask: 50, dailyProfit: 1000 }
    };

    // --- FIREBASE CONFIGURATION ---
    const firebaseConfig = {
        apiKey: "AIzaSyBAQIolFYwc0_QfaR3LC1VOwjZD0zFbYWc",
        databaseURL: "https://zone-b2e27-default-rtdb.asia-southeast1.firebasedatabase.app/",
        authDomain: "zone-b2e27.firebaseapp.com",
        projectId: "zone-b2e27",
        storageBucket: "zone-b2e27.appspot.com"
    };

    if (!firebase.apps.length) {
        firebase.initializeApp(firebaseConfig);
    }
    const auth = firebase.auth();
    const db = firebase.database();
    // Firebase storage is no longer needed for deposits but might be used elsewhere.
    const storage = firebase.storage(); 

    let currentUser = null;
    let userData = {
        walletBalance: 0,
        totalDeposit: 0,
        totalWithdraw: 0,
        activePlan: null,
        email: '',
        phone: '',
        inviteCode: '',
        deposits: [],
        withdrawals: [],
        tasksCompletedToday: 0,
        lastTaskDate: '',
        invites: { total: 0, active: 0, earnings: 0 }
    };
    
    // Countdown Interval Reference
    let countdownInterval;

    document.addEventListener('DOMContentLoaded', function() {
        checkUrlInviteCode();
        
        auth.onAuthStateChanged((user) => {
            if (user) {
                currentUser = user;
                showLoading(true, "Loading...");
                
                if (user.email === ADMIN_EMAIL) {
                    document.getElementById('adminAccessBtn').style.display = 'block';
                    loadAdminData();
                } else {
                    document.getElementById('adminAccessBtn').style.display = 'none';
                }

                loadBankDetailsForUser();

                db.ref('users/' + user.uid).on('value', (snapshot) => {
                    const data = snapshot.val();
                    if (data) {
                        userData = data;
                        if (!userData.deposits) userData.deposits = [];
                        if (!userData.withdrawals) userData.withdrawals = [];
                        if (!userData.invites) userData.invites = { total: 0, active: 0, earnings: 0 };
                        
                        if (typeof userData.tasksCompletedToday === 'undefined') userData.tasksCompletedToday = 0;
                        if (typeof userData.lastTaskDate === 'undefined') userData.lastTaskDate = '';
                        if (!userData.profilePic) userData.profilePic = 'https://iili.io/f75iDuI.jpg';

                        updateUI();
                        loadTasks();
                        updateHistoryTables();
                        updateInviteStats();
                        
                        document.getElementById('loginScreen').classList.add('auth-hidden');
                        document.getElementById('registerScreen').classList.add('auth-hidden');
                        document.getElementById('forgotScreen').classList.add('auth-hidden');
                        document.getElementById('mainAppContent').style.display = 'flex';
                        showLoading(false);
                        
                        startDashboardTimer();
                    } else {
                        showLoading(false);
                        alert('User data missing.');
                    }
                });
            } else {
                currentUser = null;
                document.getElementById('mainAppContent').style.display = 'none';
                document.getElementById('loginScreen').classList.remove('auth-hidden');
                document.getElementById('registerScreen').classList.add('auth-hidden');
                showLoading(false);
                if(countdownInterval) clearInterval(countdownInterval);
            }
        });
        
        initDraggableWhatsapp();
    });

    // --- MODAL FUNCTIONS (UPDATED) ---
    function openModal(modalId) {
        if (modalId === 'accountInfoModal') {
            document.getElementById('editEmail').value = userData.email;
            document.getElementById('editPhone').value = userData.phone || '';
            document.getElementById('editJoinDate').value = userData.joinedDate || 'N/A';
            document.getElementById('modalUserImg').src = userData.profilePic;
        } else if (modalId === 'commissionModal') {
            document.getElementById('commTotalEarned').textContent = `Rs ${userData.invites.earnings.toFixed(2)}`;
            document.getElementById('commTotalInvites').textContent = userData.invites.total;
            document.getElementById('commActiveInvites').textContent = userData.invites.active;
        }
        
        document.getElementById(modalId).classList.add('open');
    }

    function closeModal(modalId) {
        document.getElementById(modalId).classList.remove('open');
    }
    
    function saveAccountInfo() {
        const newPhone = document.getElementById('editPhone').value;
        if (!newPhone) { showAlert("Phone number cannot be empty", "error"); return; }
        showLoading(true, "Saving...");
        userData.phone = newPhone;
        saveUserData();
        showLoading(false);
        showAlert("Profile Updated Successfully", "success");
        closeModal('accountInfoModal');
    }

    function doChangePassword() {
        const newPass = document.getElementById('newPasswordInput').value;
        const confirmPass = document.getElementById('confirmNewPasswordInput').value;
        
        if (!newPass || newPass.length < 6) return showAlert('Password must be 6+ chars', 'error');
        if (newPass !== confirmPass) return showAlert('Passwords do not match', 'error');
        
        showLoading(true, "Updating...");
        currentUser.updatePassword(newPass).then(() => {
            showLoading(false);
            showAlert('Password updated successfully!', 'success');
            closeModal('changePassModal');
            document.getElementById('newPasswordInput').value = '';
            document.getElementById('confirmNewPasswordInput').value = '';
        }).catch((error) => {
            showLoading(false);
            showAlert(error.message, 'error');
        });
    }

    // --- DASHBOARD TIMER LOGIC ---
    function startDashboardTimer() {
        if(countdownInterval) clearInterval(countdownInterval);
        updateDashboardTimer();
        countdownInterval = setInterval(updateDashboardTimer, 1000);
    }
    
    function updateDashboardTimer() {
        const now = new Date();
        const tomorrow = new Date(now);
        tomorrow.setDate(tomorrow.getDate() + 1);
        tomorrow.setHours(0, 0, 0, 0); 
        
        const diff = tomorrow - now;
        if (diff <= 0) {
            document.getElementById('nextReminderTimer').textContent = "00:00:00";
            return;
        }
        
        const days = Math.floor(diff / (1000 * 60 * 60 * 24));
        const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
        const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
        const seconds = Math.floor((diff % (1000 * 60)) / 1000);
        
        const totalHours = (days * 24) + hours;
        const fHours = (totalHours < 10 ? "0" : "") + totalHours;
        const fMins = (minutes < 10 ? "0" : "") + minutes;
        const fSecs = (seconds < 10 ? "0" : "") + seconds;
        
        document.getElementById('nextReminderTimer').textContent = `${fHours}:${fMins}:${fSecs}`;
    }

    // --- ADMIN FUNCTIONS ---
    function loadAdminData() {
        db.ref('admin/settings/bank').once('value', (snap) => {
            const bank = snap.val();
            if (bank) {
                document.getElementById('adminBankName').value = bank.bankName || '';
                document.getElementById('adminAccNum').value = bank.accountNumber || '';
                document.getElementById('adminAccTitle').value = bank.accountTitle || '';
            }
        });
    }

    function saveBankDetails() {
        if (currentUser.email !== ADMIN_EMAIL) return;
        const bankName = document.getElementById('adminBankName').value;
        const accNum = document.getElementById('adminAccNum').value;
        const accTitle = document.getElementById('adminAccTitle').value;
        if(!bankName || !accNum || !accTitle) { showAlert('Fill all details', 'error'); return; }

        showLoading(true, "Updating...");
        db.ref('admin/settings/bank').set({
            bankName: bankName, accountNumber: accNum, accountTitle: accTitle
        }).then(() => {
            showLoading(false); showAlert('Bank Details Updated!', 'success');
        }).catch(err => {
            showLoading(false); showAlert(err.message, 'error');
        });
    }

    function loadBankDetailsForUser() {
        db.ref('admin/settings/bank').on('value', (snap) => {
            const bank = snap.val();
            if (bank) {
                document.getElementById('depBankName').textContent = bank.bankName;
                document.getElementById('depAccNum').textContent = bank.accountNumber;
                document.getElementById('depAccTitle').textContent = bank.accountTitle;
            }
        });
    }

    // --- AUTH ---
    function handleRegister() {
        const email = document.getElementById('regEmail').value;
        const password = document.getElementById('regPassword').value;
        const confirmPass = document.getElementById('regConfirmPassword').value;
        const phone = document.getElementById('regPhone').value;
        const inviteCode = document.getElementById('regInviteCode').value;

        if (!email || !password || !phone) { showAlert('Fill all fields', 'error'); return; }
        if (password.length < 6) { showAlert('Min password 6 chars', 'error'); return; }
        if (password !== confirmPass) { showAlert('Password mismatch', 'error'); return; }

        showLoading(true, "Registering...");
        auth.createUserWithEmailAndPassword(email, password)
            .then((cred) => {
                const newUserData = {
                    email: email, phone: phone, uid: cred.user.uid,
                    joinedDate: new Date().toLocaleDateString(),
                    usedInviteCode: inviteCode || 'NONE',
                    myInviteCode: 'USER' + Math.floor(10000 + Math.random() * 90000),
                    walletBalance: 0, totalDeposit: 0, totalWithdraw: 0, activePlan: null,
                    tasksCompletedToday: 0, lastTaskDate: '',
                    profilePic: 'https://iili.io/f75iDuI.jpg'
                };
                return db.ref('users/' + cred.user.uid).set(newUserData);
            })
            .then(() => showAlert('Registered!', 'success'))
            .catch((e) => { showLoading(false); showAlert(e.message, 'error'); });
    }

    function handleLogin() {
        const email = document.getElementById('loginEmail').value;
        const pass = document.getElementById('loginPassword').value;
        if (!email || !pass) return showAlert('Enter credentials', 'error');
        showLoading(true, "Logging in...");
        auth.signInWithEmailAndPassword(email, pass).catch(e => { showLoading(false); showAlert(e.message, 'error'); });
    }

    function logout() { showLoading(true, "Logging out..."); auth.signOut().then(() => window.location.reload()); }

    function handleResetPassword() {
        const email = document.getElementById('resetEmail').value;
        if(!email) return showAlert('Enter email', 'error');
        auth.sendPasswordResetEmail(email).then(() => { showAlert('Link sent', 'success'); showLogin(); });
    }

    function showRegister() { document.getElementById('loginScreen').classList.add('auth-hidden'); document.getElementById('registerScreen').classList.remove('auth-hidden'); }
    function showLogin() { document.getElementById('registerScreen').classList.add('auth-hidden'); document.getElementById('forgotScreen').classList.add('auth-hidden'); document.getElementById('loginScreen').classList.remove('auth-hidden'); }
    function showForgotPassword() { document.getElementById('loginScreen').classList.add('auth-hidden'); document.getElementById('forgotScreen').classList.remove('auth-hidden'); }
    function checkUrlInviteCode() {
        const urlParams = new URLSearchParams(window.location.search);
        const inviteCode = urlParams.get('invite');
        if (inviteCode) { document.getElementById('regInviteCode').value = inviteCode; showRegister(); }
    }

    // --- NAVIGATION ---
    let pageHistory = ['homePage'];
    let currentPage = 'homePage';

    function saveUserData() { if (currentUser) db.ref('users/' + currentUser.uid).update(userData); }

    function showPage(pageId) {
        if (pageId === 'adminPanelPage' && (!currentUser || currentUser.email !== ADMIN_EMAIL)) return showAlert('Access Denied', 'error');
        if (currentPage === pageId) return;

        pageHistory.push(currentPage);
        currentPage = pageId;

        document.querySelectorAll('.page-container').forEach(page => {
            page.classList.remove('page-active');
            page.classList.add('page-inactive');
        });
        document.getElementById(pageId).classList.remove('page-inactive');
        document.getElementById(pageId).classList.add('page-active');
        document.getElementById(pageId).scrollTop = 0;

        const backBtn = document.getElementById('backBtn');
        if (pageId === 'homePage') {
            backBtn.style.display = 'none';
            document.getElementById('pageTitle').textContent = 'Earning App';
        } else {
            backBtn.style.display = 'block';
            const titles = {
                'depositPage': 'Deposit Funds', 'withdrawPage': 'Withdraw Funds',
                'invitePage': 'Invite & Earn', 'adminPanelPage': 'Admin Control',
                'tasksPage': 'Daily Tasks', 'plansPage': 'VIP Plans',
                'appPage': 'Download App', 'profilePage': 'My Profile', 
                'supportPage': 'Contact Admin',
                'depositHistoryPage': 'Deposit History', 'withdrawHistoryPage': 'Withdrawal History',
                'adTimerPage': 'Viewing Ad'
            };
            document.getElementById('pageTitle').textContent = titles[pageId] || 'Earning App';
        }
        updateNavActiveState(pageId);
    }

    function goBack() {
        if (pageHistory.length > 0) {
            const previousPage = pageHistory.pop();
            document.getElementById(currentPage).classList.remove('page-active');
            document.getElementById(currentPage).classList.add('page-inactive');
            currentPage = previousPage;
            document.getElementById(currentPage).classList.remove('page-inactive');
            document.getElementById(currentPage).classList.add('page-active');
            
            if (currentPage === 'homePage') {
                document.getElementById('backBtn').style.display = 'none';
                document.getElementById('pageTitle').textContent = 'Earning App';
                pageHistory = [];
            } else {
                 const titles = {
                    'depositPage': 'Deposit Funds', 'withdrawPage': 'Withdraw Funds',
                    'invitePage': 'Invite & Earn', 'adminPanelPage': 'Admin Control',
                    'tasksPage': 'Daily Tasks', 'plansPage': 'VIP Plans',
                    'appPage': 'Download App', 'profilePage': 'My Profile', 
                    'supportPage': 'Contact Admin',
                    'depositHistoryPage': 'Deposit History', 'withdrawHistoryPage': 'Withdrawal History',
                    'adTimerPage': 'Viewing Ad'
                };
                document.getElementById('backBtn').style.display = 'block';
                document.getElementById('pageTitle').textContent = titles[currentPage] || 'Earning App';
            }
            updateNavActiveState(currentPage);
        }
    }

    function updateNavActiveState(pageId) {
        document.querySelectorAll('.nav-item').forEach(nav => nav.classList.remove('active'));
        const navMap = { 'homePage': 0, 'tasksPage': 1, 'plansPage': 'center', 'appPage': 3, 'profilePage': 4 };
        if (navMap[pageId] !== undefined && navMap[pageId] !== 'center') {
            document.querySelectorAll('.nav-item')[navMap[pageId]].classList.add('active');
        }
    }

    // --- TRANSACTIONS ---
    
    // === EDITED DEPOSIT SYSTEM SCRIPT START ===
    function previewDepositImage(event) {
        const preview = document.getElementById('depositImagePreview');
        const text = document.getElementById('depositPreviewText');
        const file = event.target.files[0];
        const reader = new FileReader();

        reader.onloadend = function() {
            preview.src = reader.result;
            preview.style.display = 'block';
            text.style.display = 'none';
        }

        if (file) {
            reader.readAsDataURL(file);
        } else {
            preview.src = "";
            preview.style.display = 'none';
            text.style.display = 'block';
        }
    }

    async function submitDeposit() {
        const proofFile = document.getElementById('depositProofImage').files[0];
        const amount = parseFloat(document.getElementById('depositAmount').value);

        if (!proofFile || !amount || amount < 300) {
            return showAlert('Min Rs 300 & a proof image are required', 'error');
        }
        
        showLoading(true, 'Uploading proof...');

        const apiKey = '31c324eeef3df98e593e1897b02cc37b';
        const apiUrl = `https://api.imgbb.com/1/upload?key=${apiKey}`;
        
        const formData = new FormData();
        formData.append('image', proofFile);
        
        try {
            const response = await fetch(apiUrl, {
                method: 'POST',
                body: formData,
            });

            const result = await response.json();

            if (result.success) {
                const imageUrl = result.data.url;
                const deposit = { 
                    id: Date.now(), 
                    date: new Date().toLocaleDateString(), 
                    amount: amount, 
                    proofImageUrl: imageUrl,
                    status: 'pending' 
                };
                
                if (!userData.deposits) userData.deposits = [];
                userData.deposits.push(deposit);
                saveUserData();
                
                showLoading(false);
                showAlert('Deposit submitted for review!', 'success');
                
                // Reset form
                document.getElementById('depositProofImage').value = '';
                document.getElementById('depositAmount').value = '';
                document.getElementById('depositImagePreview').src = '';
                document.getElementById('depositImagePreview').style.display = 'none';
                document.getElementById('depositPreviewText').style.display = 'block';

            } else {
                showLoading(false);
                showAlert(result.error?.message || 'Image upload failed. Please try again.', 'error');
            }
        } catch (error) {
            showLoading(false);
            console.error('Image upload network error:', error);
            showAlert('An error occurred during upload. Check your internet connection.', 'error');
        }
    }
    // === EDITED DEPOSIT SYSTEM SCRIPT END ===

    function submitWithdraw() {
        const account = document.getElementById('withdrawAccount').value;
        const name = document.getElementById('withdrawName').value;
        const amount = parseFloat(document.getElementById('withdrawAmount').value);
        if (!account || !name || !amount) return showAlert('Fill all fields', 'error');
        if (amount < 100) return showAlert('Min withdrawal Rs 100', 'error');
        if (amount > userData.walletBalance) return showAlert('Insufficient balance', 'error');

        const withdrawal = { id: Date.now(), date: new Date().toLocaleDateString(), amount: amount, account: account, name: name, status: 'pending' };
        if (!userData.withdrawals) userData.withdrawals = [];
        userData.withdrawals.push(withdrawal);
        userData.walletBalance -= amount;
        saveUserData();
        showAlert('Withdrawal submitted!', 'success');
        document.getElementById('withdrawAccount').value = '';
        document.getElementById('withdrawName').value = '';
        document.getElementById('withdrawAmount').value = '';
    }

    // --- PLANS (Updated) ---
    function buyPlan(amount) {
        if (userData.walletBalance < amount) {
            showAlert('Insufficient balance. Please deposit funds.', 'error');
            setTimeout(() => showPage('depositPage'), 1500);
            return;
        }
        
        const config = PLAN_CONFIG[amount];
        if (!config) {
            showAlert('Invalid plan selected.', 'error');
            return;
        }

        userData.walletBalance -= amount;
        
        userData.activePlan = {
            amount: amount,
            purchasedDate: new Date().toLocaleDateString(),
            dailyEarning: config.dailyProfit,
            dailyLimit: config.dailyLimit,
            earningPerTask: config.earningPerTask
        };
        
        userData.tasksCompletedToday = 0;
        userData.lastTaskDate = new Date().toDateString();

        saveUserData();
        showAlert(`Plan for Rs ${amount} activated successfully!`, 'success');
        showPage('tasksPage');
    }

    // --- TASKS ---
    function loadTasks() {
        const tasksList = document.getElementById('tasksList');
        const noPlan = document.getElementById('noPlanWarning');
        const limitWarning = document.getElementById('taskLimitWarning');
        
        if (!userData.activePlan) {
            tasksList.innerHTML = ''; 
            noPlan.style.display = 'block'; 
            limitWarning.style.display = 'none';
            return;
        }
        noPlan.style.display = 'none';

        const todayStr = new Date().toDateString();
        if (userData.lastTaskDate !== todayStr) {
            userData.tasksCompletedToday = 0;
            userData.lastTaskDate = todayStr;
            saveUserData();
        }

        const maxTasks = userData.activePlan.dailyLimit;
        if (userData.tasksCompletedToday >= maxTasks) {
            tasksList.innerHTML = '';
            limitWarning.style.display = 'block';
            return;
        }
        limitWarning.style.display = 'none';

        const remaining = maxTasks - userData.tasksCompletedToday;
        const reward = userData.activePlan.earningPerTask;

        let html = `<div class="card"><h3 class="card-title">Tasks Available (${remaining}/${maxTasks})</h3>`;
        
        for(let i=0; i<remaining; i++) {
            html += `
                <div class="task-item">
                    <div>
                        <div style="font-weight: bold; font-size: 14px;">Sponsored Ad Task ${userData.tasksCompletedToday + i + 1}</div>
                        <div style="font-size: 11px; color: #aaa;">Duration: 10s</div>
                    </div>
                    <div style="text-align: right;">
                        <div class="task-reward">+Rs ${reward}</div>
                        <button class="btn" style="padding: 5px 12px; font-size: 11px; margin-top: 5px; width: auto;" onclick="viewAd(${reward})">View Ad</button>
                    </div>
                </div>`;
        }
        html += '</div>';
        tasksList.innerHTML = html;
    }
    
    // --- NEW AD SYSTEM LOGIC ---
    let currentTaskReward = 0;
    let adPageTimerInterval = null;

    function viewAd(rewardAmount) {
        currentTaskReward = rewardAmount;
        window.open('https://disappearinghew.com/zqsh5azq?key=e5492d993837d52891191ad8cbc91350', '_blank');
        showPage('adTimerPage');
        startAdPageTimer();
    }
    
    function startAdPageTimer() {
        if(adPageTimerInterval) clearInterval(adPageTimerInterval);

        const circle = document.getElementById('adPageTimerProgress');
        const countText = document.getElementById('adPageTimerCount');
        let timeLeft = 10;
        countText.textContent = timeLeft;

        circle.style.transition = 'none';
        circle.style.strokeDashoffset = '0';
        circle.getBoundingClientRect(); 
        circle.style.transition = 'stroke-dashoffset 10s linear';
        circle.style.strokeDashoffset = '440';

        adPageTimerInterval = setInterval(() => {
            timeLeft--;
            if (timeLeft >= 0) {
                 countText.textContent = timeLeft;
            }
            if (timeLeft < 0) {
                clearInterval(adPageTimerInterval);
                finishTask(currentTaskReward);
                currentTaskReward = 0; 
            }
        }, 1000);
    }

    function finishTask(amount) {
        userData.walletBalance += amount;
        userData.tasksCompletedToday++;
        saveUserData();
        
        showAlert(`Task Complete! Rs ${amount} added.`, 'success');
        loadTasks();
        updateUI();

        setTimeout(() => {
            showPage('tasksPage');
        }, 1500);
    }

    // --- UTILS & UI UPDATES ---
    function updateUI() {
        document.getElementById('walletBalance').textContent = userData.walletBalance.toFixed(2);
        
        // Calculate total approved deposit
        const totalApprovedDeposit = (userData.deposits || [])
            .filter(d => d.status === 'completed')
            .reduce((sum, d) => sum + d.amount, 0);
        document.getElementById('totalDeposit').textContent = `Rs ${totalApprovedDeposit.toFixed(2)}`;

        const totalApprovedWithdraw = (userData.withdrawals || [])
            .filter(w => w.status === 'completed')
            .reduce((sum, w) => sum + w.amount, 0);
        document.getElementById('totalWithdraw').textContent = `Rs ${totalApprovedWithdraw.toFixed(2)}`;
        
        document.getElementById('displayEmail').textContent = userData.email.split('@')[0];
        document.getElementById('userProfilePic').src = userData.profilePic;

        const dailyLimit = userData.activePlan ? userData.activePlan.dailyLimit : 0;
        const completed = userData.tasksCompletedToday || 0;
        const remain = dailyLimit - completed;
        const safeRemain = remain > 0 ? remain : 0;

        document.getElementById('taskCompletedCount').textContent = completed;
        document.getElementById('taskRemainCount').textContent = safeRemain;

        document.getElementById('myInviteCode').textContent = userData.myInviteCode;
        document.getElementById('inviteLink').value = window.location.origin + window.location.pathname + '?invite=' + userData.myInviteCode;
    }

    function updateHistoryTables() {
        const deposits = userData.deposits || [];
        const depList = document.getElementById('depositHistory');
        depList.innerHTML = deposits.length ? '' : '<tr><td colspan="3" style="text-align:center;">No deposits</td></tr>';
        deposits.slice().reverse().forEach(d => {
            depList.innerHTML += `<tr><td>${d.date}</td><td>Rs ${d.amount}</td><td><span class="status status-${d.status}">${d.status}</span></td></tr>`;
        });

        const withdrawals = userData.withdrawals || [];
        const withList = document.getElementById('withdrawHistory');
        withList.innerHTML = withdrawals.length ? '' : '<tr><td colspan="3" style="text-align:center;">No withdrawals</td></tr>';
        withdrawals.slice().reverse().forEach(w => {
            withList.innerHTML += `<tr><td>${w.date}</td><td>Rs ${w.amount}</td><td><span class="status status-${w.status}">${w.status}</span></td></tr>`;
        });
    }
    
    function updateInviteStats() {
        document.getElementById('totalInvites').textContent = userData.invites.total;
        document.getElementById('activeInvites').textContent = userData.invites.active;
        document.getElementById('inviteEarnings').textContent = `Rs ${userData.invites.earnings.toFixed(2)}`;
    }

    function copyInviteCode() {
        const txt = document.createElement("textarea"); txt.value = userData.myInviteCode;
        document.body.appendChild(txt); txt.select(); document.execCommand("Copy"); txt.remove();
        showAlert('Code copied!', 'success');
    }
    
    function shareInviteLink() {
        const link = document.getElementById('inviteLink').value;
        const txt = document.createElement("textarea"); txt.value = link;
        document.body.appendChild(txt); txt.select(); document.execCommand("Copy"); txt.remove();
        showAlert('Link copied!', 'success');
    }

    function showAlert(msg, type) {
        const a = document.getElementById('alert');
        a.textContent = msg;
        a.style.backgroundColor = type === 'error' ? '#f44336' : '#4caf50';
        a.style.display = 'block';
        a.style.animation = 'slideDown 0.3s ease forwards';
        setTimeout(() => { a.style.display = 'none'; }, 3000);
    }

    function showLoading(show, message = "Loading...") { 
        document.getElementById('loadingText').textContent = message;
        document.getElementById('loadingOverlay').style.display = show ? 'flex' : 'none'; 
    }
    
    function selectWithdrawMethod(m) {
        document.querySelectorAll('#withdrawPage .payment-method').forEach(i => i.classList.remove('active'));
        event.target.closest('.payment-method').classList.add('active');
    }

    function sendEmailToAdmin() {
        const subject = document.getElementById('supportSubject').value;
        const body = document.getElementById('supportMessage').value;
        if(!subject || !body) return showAlert('Fill Subject and Message', 'error');
        window.location.href = `mailto:${ADMIN_EMAIL}?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
    }

    let isDragging = false, dragStartTime = 0;
    function handleClickWhatsapp() { 
        if (Date.now() - dragStartTime < 200 && !isDragging) {
            window.open('', '_blank');
        }
    }
    function initDraggableWhatsapp() {
        const btn = document.getElementById('whatsappFloat');
        let offset = {x:0, y:0};
        btn.addEventListener('touchstart', (e) => {
            isDragging=false; dragStartTime=Date.now();
            const touch=e.touches[0], rect=btn.getBoundingClientRect();
            offset.x=touch.clientX-rect.left; offset.y=touch.clientY-rect.top;
        });
        btn.addEventListener('touchmove', (e) => {
            e.preventDefault(); isDragging=true;
            const touch=e.touches[0], app=document.querySelector('.app-container'), rect=app.getBoundingClientRect();
            let l=touch.clientX-rect.left-offset.x, t=touch.clientY-rect.top-offset.y;
            if(l<0)l=0; if(l>rect.width-btn.offsetWidth)l=rect.width-btn.offsetWidth;
            if(t<0)t=0; if(t>rect.height-btn.offsetHeight)t=rect.height-btn.offsetHeight;
            btn.style.right='auto'; btn.style.bottom='auto'; btn.style.left=l+'px'; btn.style.top=t+'px';
        });
    }
</script>

</body>
</html>
